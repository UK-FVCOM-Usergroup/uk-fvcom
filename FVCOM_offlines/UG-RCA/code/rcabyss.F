      MODULE ALLOCENDUMPS
      IMPLICIT NONE
      SAVE
      REAL, ALLOCATABLE, DIMENSION(:,:,:) :: DUMPS
      END MODULE ALLOCENDUMPS

      SUBROUTINE  RCABYSS (NGDMP,JSYS)
!
!        RCABYSS PRODUCES A SYSTEM DUMP FILE FROM THE MASTER DUMP FILE
!                (RCAF11) GENERATED BY THE USER KINETIC SUBR. -TUNER-
!
      USE ALLOCENDUMPS
      USE ALL_VARS, ONLY : M,SERIAL,PAR
      USE MOD_RCA
# if defined (MULTIPROCESSOR)
      USE MOD_PAR
# endif

      IMPLICIT NONE
      SAVE
!      INCLUDE  'RCACM'
      INTEGER NGDMP,JSYS
      INTEGER IT,ISYSTEM
      ALLOCATE(DUMPS(NXY,NZ,NGDMP))
!     LOOP TO READ DUMP FILE INTO CORE ARRAY
      REWIND 11
      DO IT=1,IREC
       DO ISYSTEM=1,NGDMP
        READ(11)  ((DUMPS(IXY,IZ,ISYSTEM),IXY=1,NXY),IZ=1,NZ)
       END DO

!      MOVE FROM READ BUFFER TO VIRTUAL ARRAY
       IF(SERIAL)THEN
        DO IZ=1,NZ
         DO IXY=1,NXY
          SCRATCH_ARRAY(IXY,IZ,IT) = DUMPS(IXY,IZ,JSYS)
         END DO
	END DO 
       END IF
       	
# if defined (MULTIPROCESSOR)
       IF(PAR)THEN
        DO IZ=1,NZ
         DO IXY=1,M
          SCRATCH_ARRAY(IXY,IZ,IT) = DUMPS(NGID(IXY),IZ,JSYS)
         END DO
         DO IXY=1,NHN
          SCRATCH_ARRAY(IXY+M,IZ,IT) = DUMPS(HN_LST(IXY),IZ,JSYS)
         END DO
	END DO 
       END IF	
# endif
      END DO
      DEALLOCATE(DUMPS)
      RETURN
      END SUBROUTINE  RCABYSS
